Ext.grid.XPrinter=function(a){Ext.apply(this,a);this.addEvents('afterPrint','closedPrintWindow');Ext.grid.XPrinter.superclass.constructor.call(this)};Ext.reg('XPrinter',Ext.grid.XPrinter);Ext.extend(Ext.grid.XPrinter,Ext.util.Observable,{styles:'default',pathPrinter:'./xprinter',pdfEnable:false,paperOrientation:'p',logoURL:'',wWidth:750,wHeight:700,excludefields:'',hasrowAction:false,usenameindex:false,localeData:{Title:'Title',subTitle:'Subtitle',footerText:'Page footer',pageNo:'Page #',printText:'Print document',closeText:'Close document',pdfText:''},useCustom:{custom:false,customStore:null,customTPL:false,TPL:null,columns:[],alignCols:[],pageToolbar:null,useIt:false,showIt:false,location:'bbar'},showdate:true,showdateFormat:'d-m-Y',showFooter:true,footerText:'',renderers:null,init:function(){;this.htmloutput='';this.flagdatachange=false;this.flagrenderedPtool=false},prepare:function(){if(this.paperOrientation=='p'||this.paperOrientation=='l'){}else{this.paperOrientation='p'}if(this.useCustom.customTPL){if(this.pdfEnable){this.PrinterWindow=window.open(this.pathPrinter+"/base_print_002.php?xlsgen=1&pdfgen=1&paper="+this.paperOrientation,"PrinterWindow","width="+this.wWidth+",height="+this.wHeight+",resizable=1,scrollbars=1")}else{this.PrinterWindow=window.open(this.pathPrinter+"/base_print_002.php?xlsgen=1&paper="+this.paperOrientation,"PrinterWindow","width="+this.wWidth+",height="+this.wHeight+",resizable=1,scrollbars=1")}this.PrinterWindow.focus()}else{if(this.pdfEnable){this.PrinterWindow=window.open(this.pathPrinter+"/base_print_001.php?xlsgen=1&pdfgen=1&paper="+this.paperOrientation,"PrinterWindow","width="+this.wWidth+",height="+this.wHeight+",resizable=1,scrollbars=1")}else{this.PrinterWindow=window.open(this.pathPrinter+"/base_print_001.php?xlsgen=1&paper="+this.paperOrientation,"PrinterWindow","width="+this.wWidth+",height="+this.wHeight+",resizable=1,scrollbars=1")}this.PrinterWindow.focus()}},getDatareport:function(){var b=new Date();if(this.showdate){datetorpint=b.format(this.showdateFormat)}else{datetorpint=''}if(this.pdfEnable){var c=this.localeData.pdfText}else{var c=''}var d={title:this.localeData.Title,subtitle:this.localeData.subTitle,date:b.format(this.showdateFormat),footer:this.localeData.footerText,currpage:this.localeData.pageNo,valuebody:'{valuebody}',pageno:'{pageno}',pdfprint:this.pdfEnable,pdfTextgen:c};var e=new Ext.XTemplate('<link href="'+this.styles+'.css" rel="stylesheet" type="text/css" media="screen" />','<link href="'+this.styles+'_printer_out.css" rel="stylesheet" type="text/css" media="print"/>','<div class="printer_controls">{pdfprint:this.chkpdf}{pdfTextgen:this.chkPdftext}','<img src="images/page_excel.png" width="16" height="16" onclick="genXLS();" /> <a href="javascript:window.genXLS();"> Excel</a> | ','<img src="images/printer.png" onclick="javascript:window.print();"/> <a href="javascript:window.print();">'+this.localeData.printText+'</a> | ','<img src="images/cancel.png"  onclick="javascript:window.close();"/> <a href="javascript:window.close();">'+this.localeData.closeText+'</a></div>','<div id="myresult" class="printer">','<div id="myresult" class="printer">','<table width="100%" border="0" cellspacing="1" cellpadding="0">','<tr><td width="15%" rowspan="3"> <img src="'+this.logoURL+'" width="90" height="70"/></td>','<td width="85%" class="date"><div align="left"></div></td></tr>','<tr><td><div class="title">{title}</div></td></tr>','{subtitle:this.chksubtitle}','<tr><td class="date"> <div style="font-size:7px;text-align:left;">{date}<div> </td></tr></table>','<hr noshade="noshade" width="100%" align="left"/>','<div id="data-table">{valuebody}</div>','<table width="100%" border="0" cellspacing="3" cellpadding="0"><tr><td colspan="2" class="subtitle">','<hr noshade="noshade" width="100%" align="left"/></td></tr><tr>','<td colspan="2" class="footer">{pageno}{footer}</td></tr></table>','</div><div id="endreport"></div>',{chksubtitle:function(a){if(a==''){return'<tr><td>&nbsp;</td></tr>'}else{return'<tr><td><div class="subtitle">'+a+'</div></td></tr>'}},chkpdf:function(a){if(a){return'<img src="images/page_white_acrobat.png" width="16" height="16" onclick="genPDF();" /> '}else{return''}},chkPdftext:function(a){if(a==''){return''}else{return' <a href="javascript:genPDF();">'+a+'</a> | '}}});var f=e.applyTemplate(d);if(this.useCustom.custom==false){var g=(this.grid.getColumnModel().getColumnCount());columnstext='<table width="100%" border="0" cellspacing="1" cellpadding="0" ><tr>';for(var i=0;i<g;i++){var h=this.grid.getColumnModel().config[i].id;if(h=='numberer'||h=='checker'){}else{if(this.grid.getColumnModel().isHidden(i)){}else{if(this.excludefields.indexOf(''+i+',')>=0){}else{columnstext+='<td valign="middle"><div class="header" style="font-size:8px;">'+this.grid.getColumnModel().getColumnHeader(i)+'</div></td>'}}}}columnstext+='</tr>';varnumrecs=this.grid.store.getCount();tdvalues='';for(var i=0;i<varnumrecs;i++){tdvalues+='<tr>';var j=this.grid.store.getAt(0).fields.length;for(var k=0;k<j;k++){if(k>(this.grid.getColumnModel().config.length-1)){}else{var h=this.grid.getColumnModel().config[0].id;var l=0;if(h=='numberer'||h=='checker'){var m=k+1;l=this.grid.getColumnModel().config.length-1}else{var m=k;l=this.grid.getColumnModel().config.length}if(this.hasrowAction){if(m==j){if(this.hasrowAction){}else{break}}}else{var h=11}var n=false;if(m>(l)){n=true}else{n=this.grid.getColumnModel().isHidden(m)}if(n){var h=11}else{if(this.excludefields.indexOf(''+m+',')>=0){}else{var o=this.grid.getColumnModel().getRenderer(m);tdvalues+='<td valign="middle" style="font-size:7px;" class="values" align="'+this.grid.getColumnModel().config[m].align+'">';if(this.usenameindex==false){tdvalues+=o.call(this,this.grid.store.getAt(i).data[this.grid.store.getAt(i).fields.items[k].name])||'&nbsp;'}else{tdvalues+=o.call(this,this.grid.store.getAt(i).data[this.grid.getColumnModel().config[m].dataIndex])||'&nbsp;'}tdvalues+='</td>'}}}}tdvalues+='</tr>'}tdvalues+='</table>';if(this.useCustom.useIt){if(this.useCustom.location=='bbar'){tmppagetool=this.grid.getBottomToolbar()}else{tmppagetool=this.grid.getTopToolbar()}var p=tmppagetool.getPageData().activePage}else{var p=1}}else{var g=this.useCustom.columns.length;columnstext='<table width="90%" border="0" cellspacing="1" cellpadding="0"><tr>';for(var i=0;i<g;i++){columnstext+='<td class="header">'+this.useCustom.columns[i]+'</td>'}columnstext+='</tr>';varnumrecs=this.useCustom.customStore.getCount();tdvalues='';for(var i=0;i<varnumrecs;i++){tdvalues+='<tr>';var j=this.useCustom.customStore.getAt(0).fields.length;for(var k=0;k<j;k++){var m=k;tdvalues+='<td class="values" align="'+this.useCustom.alignCols[m]+'">';tdvalues+=this.useCustom.customStore.getAt(i).data[this.useCustom.customStore.getAt(i).fields.items[k].name];tdvalues+='</td>'}tdvalues+='</tr>'}tdvalues+='</table>';var p=this.useCustom.pageToolbar.getPageData().activePage};datareportb={pageno:this.localeData.pageNo+' '+p+' | ',valuebody:columnstext+tdvalues};var q=new Ext.XTemplate(f);var r=q.applyTemplate(datareportb);return r},printCustom:function(b){var c=new Date();if(this.showdate){datetorpint=c.format(this.showdateFormat)}else{datetorpint=''}if(this.pdfEnable){var d=this.localeData.pdfText}else{var d=''}var e={title:this.localeData.Title,subtitle:this.localeData.subTitle,date:c.format(this.showdateFormat),footer:this.localeData.footerText,currpage:this.localeData.pageNo,valuebody:'{valuebody}',pageno:'{pageno}',pdfprint:this.pdfEnable,pdfTextgen:d};var f=new Ext.XTemplate('<link href="'+this.styles+'.css" rel="stylesheet" type="text/css" media="screen" />','<link href="'+this.styles+'_printer_out.css" rel="stylesheet" type="text/css" media="print"/>','<div class="printer_controls">{pdfprint:this.chkpdf}{pdfTextgen:this.chkPdftext}','<img src="images/printer.png" onclick="javascript:window.print();"/> <a href="javascript:window.print();">'+this.localeData.printText+'</a> | ','<img src="images/cancel.png"  onclick="javascript:window.close();"/> <a href="javascript:window.close();">'+this.localeData.closeText+'</a></div>','<div id="myresult" class="printer">','<table width="100%" border="0" cellspacing="3" cellpadding="0"><tr>','<td width="89%" class="date">{date}</td><td width="11%" rowspan="3" class="date">','<img src="'+this.logoURL+'" width="87" height="67" /></td></tr>','<tr><td class="title">{title}</td></tr>','{subtitle:this.chksubtitle}','<tr><td colspan="2" class="subtitle"><hr noshade="noshade" width="100%" /></td></tr>','<tr><td colspan="2">','{valuebody}<div id="cntrptdata"></div>','</td></tr><tr><td colspan="2" class="subtitle"><hr noshade="noshade" width="100%" /></td>','</tr><tr>','<td colspan="2" class="footer">{pageno}{footer}</td>','</tr></table></div><div id="endreport"></div>',{chksubtitle:function(a){if(a==''){return'<tr><td>&nbsp;</td></tr>'}else{return'<tr><td class="subtitle">'+a+'</td></tr>'}},chkpdf:function(a){if(a){return'<img src="images/page_white_acrobat.png" width="16" height="16" onclick="genPDF();" /> '}else{return''}},chkPdftext:function(a){if(a==''){return''}else{return' <a href="javascript:genPDF();">'+a+'</a> | '}}});var g=f.applyTemplate(e);if(this.localeData.pageNo==""){var h=""}else{var h=this.localeData.pageNo+' 1 | '};datareportb={pageno:h};var i=new Ext.XTemplate(g);var j=i.applyTemplate(datareportb);this.pageOBJ=b;b.document.title=this.localeData.Title;if(this.useCustom.pageToolbar){var k=this.useCustom.customStore.getCount();if(k<this.useCustom.pageToolbar.pageSize){}else{this.useCustom.pageToolbar.render(b.document.body);this.flagrenderedPtool=true}}Ext.get(b.document.body).insertHtml('beforeEnd','<div id="reportcontent">'+j+'</div>',false);var l=new Ext.DataView({store:this.useCustom.customStore,tpl:this.useCustom.TPL,autoHeight:true,multiSelect:false,overClass:'',itemSelector:'',emptyText:'No hay Registros'});l.render(b.document.getElementById('cntrptdata'));this.flagdatachange=true},printGrid:function(a){this.pageOBJ=a;var b=this.getDatareport();a.document.title=this.localeData.Title;if(this.useCustom.custom){var c=this.useCustom.customStore.getCount();if(c<this.useCustom.pageToolbar.pageSize){}else{this.useCustom.pageToolbar.render(a.document.body);this.flagrenderedPtool=true}}Ext.get(a.document.body).insertHtml('beforeEnd','<div id="reportcontent">'+b+'</div>',false);this.flagdatachange=true},newPage:function(){var a=this.getDatareport();var b=Ext.get(this.pageOBJ.document.getElementById('reportcontent'));b.update(a);this.flagdatachange=true}});